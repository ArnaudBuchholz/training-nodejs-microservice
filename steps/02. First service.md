# Step 2 : First service

## Introduction

To reproduce *(simulate)* the micro services **architecture**, a **first** service is created to reproduce the **API gateway**. This service makes the APIs **available** to the clients.

## Building a web server

It is possible to build a web server **only** using the Node.js native [`http` module](https://nodejs.org/api/http.html). However, the process is **tedious** and there are **caveats** you are not aware of.

It is simpler *(and faster)* to **rely** on existing package that **helps you build** the server.

## Installing express

To create the web server *(and all subsequent services)*, the popular [`express` package](https://www.npmjs.com/package/express) is used.

![express version](https://img.shields.io/npm/v/express.svg)
![express downloads](https://img.shields.io/npm/dm/express.svg)
![install size](https://packagephobia.com/badge?p=express)

To install the package, execute `npm install express --save`

> NOTE
>> The `--save` switch indicates that the `package.json` file is modified to include the package as a **dependency**.
It is also possible to create **development dependencies** with the `--save-dev` switch : these dependencies are **not required** to execute the project.

Once completed, the `package.json` contains :

```json
{
  "name": "workshop-microservice",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "express": "^4.17.1"
  }
}
```

> package.json after installing express

Also, a file named `package-lock.json` is created : it contains the list of all **dependencies** and **sub-dependencies** that are installed with **their versions**. This guarantees that when the package is **deployed**, it will be installed with the versions that were **tested** *(and not the latest)*.

For instance, `express` includes a total of [52 dependencies](https://npm.anvaka.com/#/view/2d/express). It explains the [install size](
https://packagephobia.com/result?p=express).

## Creating the API gateway

* In the `workshop-microservice` directory
* Create a new folder named `src` : `mkdir src`
* Change current directory to the created one : `cd src`
* Create a new folder folder named `services` : `mkdir services`
* Change current directory to the created one : `cd services`
* Create a new file named `api.js`
* Copy the following code in the file :

```javascript
const express = require('express')

const app = express()

app.get('/', (req, res) => {
  res.send('Hello World')
})

const port = process.env.API_GATEWAY_PORT || 8080
app.listen(port, () => {
  console.log(`API gateway listening on port ${port}`)
})
```

> First version of the API gateway service

> NOTE
>> It is a **common practice** to make the service port configurable using environment variables : they are available through the [`process.env` dictionary](https://nodejs.org/api/process.html#process_process_env).

## Starting the API gateway

To start the service from the `workshop-microservice` directory, simply execute `node src/services/api`.

```
workshop-microservice>node src/services/api
API gateway listening on port 8080
```

> Starting the api gateway

## Testing the API gateway

The simplest way to test the service is to open a browser and use the following URLs :

* http://localhost:8080/ : the `Hello World` text should appear in the browser.

* http://localhost:8080/api/test : a generic error is generated by `express`
